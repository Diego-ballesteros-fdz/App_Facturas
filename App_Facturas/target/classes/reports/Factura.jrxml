<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" 
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" 
              name="Factura_Final" 
              pageWidth="595" pageHeight="842" 
              columnWidth="555" 
              leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" 
              uuid="4eedbb89-b4f6-4469-9ab6-f642a1688cf7">

    <parameter name="idFactura" class="java.lang.Integer"/>

    <queryString language="SQL">
        <![CDATA[
        SELECT 
            f.idFactura,
            f.fecha,
            (SELECT SUM(lf2.subtotal) FROM LINEA_FACTURA lf2 WHERE lf2.idFactura = f.idFactura) as total_factura,
            e.nombre as cliente_nombre,
            e.nif as cliente_nif,
            p.nombre as producto_nombre,
            lf.cantidad,
            lf.precioUnitario,
            lf.subtotal as linea_subtotal
        FROM FACTURA f
        INNER JOIN LINEA_FACTURA lf ON f.idFactura = lf.idFactura
        INNER JOIN ENTIDAD e ON f.idEntidad = e.idEntidad
        INNER JOIN PRODUCTO p ON lf.idProducto = p.idProducto
        WHERE f.idFactura = $P{idFactura}
        ]]>
    </queryString>

    <field name="idFactura" class="java.lang.Long"/>
    <field name="fecha" class="java.sql.Date"/>
    <field name="total_factura" class="java.math.BigDecimal"/>
    <field name="cliente_nombre" class="java.lang.String"/>
    <field name="cliente_nif" class="java.lang.String"/>
    <field name="producto_nombre" class="java.lang.String"/>
    <field name="cantidad" class="java.lang.Integer"/>
    <field name="precioUnitario" class="java.math.BigDecimal"/>
    <field name="linea_subtotal" class="java.math.BigDecimal"/>

    <background>
        <band splitType="Stretch"/>
    </background>

    <title>
        <band height="100" splitType="Stretch">
            <staticText>
                <reportElement x="0" y="0" width="200" height="30" uuid="067e6c11-1b2a-43d9-a352-162706306540"/>
                <textElement>
                    <font size="20" isBold="true"/>
                </textElement>
                <text><![CDATA[FACTURA]]></text>
            </staticText>
            
            <staticText>
                <reportElement x="0" y="40" width="80" height="20" uuid="93433503-4674-42b7-842e-152744319801"/>
                <textElement>
                    <font isBold="true"/>
                </textElement>
                <text><![CDATA[Cliente:]]></text>
            </staticText>
            
            <textField>
                <reportElement x="80" y="40" width="200" height="20" uuid="7d22811d-2315-46ae-83d4-068361732050"/>
                <textFieldExpression><![CDATA[$F{cliente_nombre}]]></textFieldExpression>
            </textField>

            <staticText>
                <reportElement x="0" y="60" width="80" height="20" uuid="8a543312-5883-49c8-913e-192855420912"/>
                <textElement>
                    <font isBold="true"/>
                </textElement>
                <text><![CDATA[NIF:]]></text>
            </staticText>

            <textField>
                <reportElement x="80" y="60" width="200" height="20" uuid="c2445520-6994-40da-a246-102966531123"/>
                <textFieldExpression><![CDATA[$F{cliente_nif}]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="400" y="0" width="150" height="20" uuid="d3556631-7005-41eb-b357-113077642234"/>
                <textElement textAlignment="Right"/>
                <textFieldExpression><![CDATA["Fecha: " + new java.text.SimpleDateFormat("dd/MM/yyyy").format($F{fecha})]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="400" y="20" width="150" height="20" uuid="e4667742-8116-42fc-c468-124188753345"/>
                <textElement textAlignment="Right"/>
                <textFieldExpression><![CDATA["Factura Nº: " + $F{idFactura}]]></textFieldExpression>
            </textField>
        </band>
    </title>

    <columnHeader>
        <band height="30" splitType="Stretch">
            <staticText>
                <reportElement x="0" y="0" width="250" height="30" uuid="f5778853-9227-430d-d579-135299864456"/>
                <box bottomPadding="5">
                    <bottomPen lineWidth="1.0"/>
                </box>
                <textElement verticalAlignment="Bottom">
                    <font isBold="true"/>
                </textElement>
                <text><![CDATA[Producto]]></text>
            </staticText>
            <staticText>
                <reportElement x="250" y="0" width="50" height="30" uuid="06889964-a338-441e-e680-146310975567"/>
                <box bottomPadding="5">
                    <bottomPen lineWidth="1.0"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Bottom">
                    <font isBold="true"/>
                </textElement>
                <text><![CDATA[Cant.]]></text>
            </staticText>
            <staticText>
                <reportElement x="300" y="0" width="100" height="30" uuid="17990075-b449-452f-f791-157421086678"/>
                <box bottomPadding="5">
                    <bottomPen lineWidth="1.0"/>
                </box>
                <textElement textAlignment="Right" verticalAlignment="Bottom">
                    <font isBold="true"/>
                </textElement>
                <text><![CDATA[Precio Unit.]]></text>
            </staticText>
            <staticText>
                <reportElement x="400" y="0" width="155" height="30" uuid="28001186-c550-4630-0802-168532197789"/>
                <box bottomPadding="5">
                    <bottomPen lineWidth="1.0"/>
                </box>
                <textElement textAlignment="Right" verticalAlignment="Bottom">
                    <font isBold="true"/>
                </textElement>
                <text><![CDATA[Subtotal]]></text>
            </staticText>
        </band>
    </columnHeader>

    <detail>
        <band height="25" splitType="Stretch">
            <textField>
                <reportElement x="0" y="0" width="250" height="20" uuid="39112297-d661-4741-1913-179643208890"/>
                <textFieldExpression><![CDATA[$F{producto_nombre}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="250" y="0" width="50" height="20" uuid="40223308-e772-4852-2024-180754319901"/>
                <textElement textAlignment="Center"/>
                <textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0.00">
                <reportElement x="300" y="0" width="100" height="20" uuid="51334419-f883-4963-3135-191865421012"/>
                <textElement textAlignment="Right"/>
                <textFieldExpression><![CDATA[$F{precioUnitario}]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0.00">
                <reportElement x="400" y="0" width="155" height="20" uuid="62445520-0994-4074-4246-202976532123"/>
                <textElement textAlignment="Right"/>
                <textFieldExpression><![CDATA[$F{linea_subtotal}]]></textFieldExpression>
            </textField>
        </band>
    </detail>

    <summary>
        <band height="50" splitType="Stretch">
            <staticText>
                <reportElement x="300" y="10" width="100" height="30" uuid="73556631-1005-4185-5357-214087643234"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="14" isBold="true"/>
                </textElement>
                <text><![CDATA[TOTAL:]]></text>
            </staticText>
            <textField pattern="#,##0.00 ¤">
                <reportElement x="400" y="10" width="155" height="30" uuid="84667742-2116-4296-6468-225198754345"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="14" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{total_factura}]]></textFieldExpression>
            </textField>
        </band>
    </summary>

</jasperReport>